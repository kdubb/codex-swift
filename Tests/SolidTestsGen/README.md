
# SolidTests Data Generators

## Numerics

To ensure accurate implementation the `BigDecimal`, `BigInt`, & `BigUInt` tests are driven by data generated by python scripts.
The scripts use python's arbitrary-length `int` and the `decimal` package to produce data to initialize an instance of the type
under test (e.g., `BigUInt`) along with the **results** of the operation under test (e.g., addition). The goal is to ensure the
arithmetic operation implementations are tested against a known implementation.

## Usage

The generated data is organized by functionality. For each functionality arguments are generated that are designed to be passed
to a [Swift Testing](https://developer.apple.com/documentation/testing/) utilizing the
[parameterized test feature](https://developer.apple.com/documentation/testing/parameterizedtesting).

### Loading Data

Each type utilizing generated test data has an accompanying structure implementing the `TestData` protocol that loads all the
generated test data.

To load the tests in a test use the `TestData.loadFromBundle()` function.
```swift

public struct SomeTypeTestData: TestData, Codable, Sendable {
  // Test data by functionality...
  var someFunctionality: SomeFunctionalityTest
}

@Suite
struct SomeTypeTest {

  // Load the test data
  static let testData = SomeTypeTestData.loadFromBundle()

  @Test("Some Functionality", arguments: testData.someFunctionality.map { ($0.arg1, $0.arg2) })
  func someFunctionality(arg1: SomeArg, arg2: SomeArg) {
    // execute test
  }

}

```



## Regenerating

The test data is stored as JSON files and is committed to the repoistory, making regenerating only necessary when updating or
adding tests.

To regenerate the tests you need a python `3.13+` environment with the `numpy` package installed.

### Step by Step

1. [Prepare Python Environment](#prepare-python-environment)
2. [Execute Generator](#execute-generator)
3. Profit!

#### Prepare Python Environment

You can use any python environment (e.g., system, homebrew, etc.) but an isolated environment is usually best.

Here's an example using `mise` to install/link to python 3.13.x:
```shell
cd <package-root>/Tests/SolidTestGen
mise use python@3.13
```

Now we can create a `venv` virtual environment to install the required packages (copies the version managed by `mise`):
```shell
python -m venv .venv
```

We can use `mise` to auto-activate the `.venv` python environemt, ensuring anytime we switch to the `SolidTestsGen` the environment is activated:
```shell
mise config set env._.python.venv.path .venv
```


#### Python Packages

Use the `requirements.txt` to install the required packages:
```shell
pip install -r requirements.txt
```


### Execute Generator

To generate the test data you run the `generate.py` script from the `SolidTestsGen` directory:
```shell
python generate.py
```
